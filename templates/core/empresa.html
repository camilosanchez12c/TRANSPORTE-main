{% extends "core/base.html" %}
{% load static %}

{% block title %}Dashboard Empresa{% endblock %}

{% block extra_head %}
  <!-- Font Awesome (iconos) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- cliente.css (topbar/footer visual). -->
  <link rel="stylesheet" href="{% static 'core/css/cliente.css' %}">
  <!-- estilos específicos de la vista empresa -->
  <link rel="stylesheet" href="{% static 'core/css/empresa.css' %}">
{% endblock %}

{% block content %}
<div class="app-root">

  <!-- TOPBAR (fijo al top, siempre visible) -->
  <header class="topbar" role="banner">
    <div class="topbar-inner">
      <div class="topbar-left">
        <div class="logo-badge">
          <img src="{% static 'core/img/logo.png' %}" alt="logo" class="topbar-logo">
        </div>
        <h1 class="topbar-title">Dashboard Empresa</h1>
      </div>

      <div class="topbar-right">
        <nav class="topbar-links" aria-label="Top links">
          <a href="#" class="muted">Empresa</a>
          <a href="#" class="muted">Para Empresas</a>
        </nav>

        <button class="btn topbar-ingresar d-none d-md-inline" type="button">INGRESAR</button>

        <!-- botón hamburguesa móvil -->
        <button
          class="btn btn-ghost d-md-none open-offcanvas-btn"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasSidebar"
          aria-controls="offcanvasSidebar"
          aria-label="Abrir menú"
        >
          <i class="fa-solid fa-bars" aria-hidden="true"></i>
        </button>

        <div class="avatar" aria-hidden="true"><i class="fa-solid fa-user"></i></div>
      </div>
    </div>
  </header>

  <!-- SIDEBAR (desktop). brand imagen está oculta en CSS en desktop -->
  <aside class="sidebar d-none d-md-flex" id="sidebar" aria-label="Sidebar principal">
    <div class="brand" aria-hidden="true">
      <img src="{% static 'core/img/logo.png' %}" alt="logo" class="brand-logo">
    </div>

    <nav class="nav flex-column" aria-label="Navegación principal">
      <a class="nav-item active" href="#"><i class="fa-solid fa-house"></i><span>Inicio</span></a>
      <a class="nav-item" href="#"><i class="fa-solid fa-truck"></i><span>Vals Asignaciones</span></a>
      <a class="nav-item" href="#"><i class="fa-solid fa-pen-to-square"></i><span>Editar</span></a>
      <a class="nav-item" href="#"><i class="fa-solid fa-list"></i><span>Gestión de Flota</span></a>
      <a class="nav-item" href="#"><i class="fa-solid fa-users"></i><span>Operadores</span></a>
      <a class="nav-item" href="#"><i class="fa-regular fa-id-card"></i><span>Mis Operadores</span></a>
      <a class="nav-item" href="#"><i class="fa-solid fa-clock-rotate-left"></i><span>Historial</span></a>
      <a class="nav-item" href="#"><i class="fa-solid fa-inbox"></i><span>Solicitudes Recibidas</span></a>
      <a class="nav-item" href="#"><i class="fa-solid fa-list-check"></i><span>Mis Ofertas</span></a>
      <a class="nav-item" href="#"><i class="fa-solid fa-gear"></i><span>Configuración</span></a>
    </nav>

    <div class="sidebar-footer">© 2025 - Información Legal</div>
  </aside>

  <!-- OFFCANVAS (mobile) - ahora incluye iconos y estilos activos -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasSidebar" aria-labelledby="offcanvasSidebarLabel">
    <div class="offcanvas-header">
      <div class="offcanvas-brand">
        <img src="{% static 'core/img/logo.png' %}" alt="logo" class="offcanvas-logo">
      </div>
      <h5 id="offcanvasSidebarLabel">Menú Empresa</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
    </div>

    <div class="offcanvas-body">
      <nav class="nav flex-column" aria-label="Navegación móvil">
        <!-- replicamos iconos como en el sidebar desktop -->
        <a class="nav-item" href="#"><i class="fa-solid fa-house me-2"></i>Inicio</a>
        <a class="nav-item" href="#"><i class="fa-solid fa-truck me-2"></i>Vals Asignaciones</a>
        <a class="nav-item" href="#"><i class="fa-solid fa-pen-to-square me-2"></i>Editar</a>
        <a class="nav-item" href="#"><i class="fa-solid fa-list me-2"></i>Gestión de Flota</a>
        <a class="nav-item" href="#"><i class="fa-solid fa-users me-2"></i>Operadores</a>
        <a class="nav-item" href="#"><i class="fa-regular fa-id-card me-2"></i>Mis Operadores</a>
        <a class="nav-item" href="#"><i class="fa-solid fa-clock-rotate-left me-2"></i>Historial</a>
        <a class="nav-item" href="#"><i class="fa-solid fa-inbox me-2"></i>Solicitudes Recibidas</a>
        <a class="nav-item" href="#"><i class="fa-solid fa-list-check me-2"></i>Mis Ofertas</a>
        <a class="nav-item" href="#"><i class="fa-solid fa-gear me-2"></i>Configuración</a>
      </nav>
    </div>
  </div>

  <!-- MAIN content area (responsive) -->
  <main class="main" id="mainContent" role="main">
    <div class="page-shell">

      <!-- KPIs: grid responsivo -->
      <div class="kpi-grid" role="region" aria-label="Indicadores">
        <div class="kpi-card" tabindex="0">
          <h3>Solicitudes Pendientes</h3>
          <div class="kpi-number">12</div>
          <div class="kpi-sub">En curso</div>
        </div>

        <div class="kpi-card" tabindex="0">
          <h3>Ofertas Enviadas</h3>
          <div class="kpi-number">45</div>
          <div class="kpi-sub">Activas</div>
        </div>

        <div class="kpi-card" tabindex="0">
          <h3>Servicios Completados</h3>
          <div class="kpi-number">3</div>
          <div class="kpi-sub">Activos hoy</div>
        </div>
      </div>

      <!-- Resumen -->
      <section class="panel summary-panel">
        <h2>Resumen de Flota y Personal</h2>
        <div class="row g-3 mt-2">
          <div class="col-12 col-md-4">
            <div class="mini-card">
              <h4>Vehículos Disponibles</h4>
              <p class="mini-sub">Total: 22</p>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="mini-card">
              <h4>Operadores Activos</h4>
              <p class="mini-sub">Activos: 22</p>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="mini-card actions-card">
              <div>
                <h4>Crear Nueva Oferta</h4>
                <p class="mini-sub small">Revisar empresa "Logística del Sur"</p>
              </div>
              <div class="mt-3 d-flex justify-content-end">
                <button class="btn btn-primary">GENERAR OFERTA</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Tabla -->
      <section class="panel table-panel">
        <h2>Solicitudes de Servicio Recibidas</h2>
        <div class="table-responsive">
          <table class="styled-table" role="table">
            <thead>
              <tr><th>ID</th><th>Ruta</th><th>Cliente</th><th>Estado</th><th>Fecha</th><th>Indicador</th></tr>
            </thead>
            <tbody>
              <tr><td>1</td><td>Cali - Bogotá</td><td>Logística del Sur</td><td>En Curso</td><td>10/10</td><td><span class="dot dot-orange"></span></td></tr>
              <tr><td>2</td><td>Medellín</td><td>Validar empresa</td><td>Revisión</td><td>11/10</td><td><span class="dot dot-orange"></span></td></tr>
              <tr><td>3</td><td>Cartagena</td><td>Confirmado</td><td>Finalizado</td><td>15/10</td><td><span class="dot dot-dark"></span></td></tr>
            </tbody>
          </table>
        </div>
      </section>
    </div>
  </main>

  <!-- Footer (fijo abajo) -->
  <footer class="site-footer" role="contentinfo">
    <div class="footer-inner">
      <div>© {{ year|default:"2025" }} Tu Empresa</div>
      <div>Privacidad · Términos</div>
    </div>
  </footer>

</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  // Avoid horizontal shift
  document.documentElement.style.overflowX = 'hidden';
  document.body.style.overflowX = 'hidden';

  // Desktop and mobile nav items
  const desktopLinks = Array.from(document.querySelectorAll('.sidebar .nav .nav-item'));
  const mobileLinks = Array.from(document.querySelectorAll('#offcanvasSidebar .nav .nav-item'));

  function clearActiveAll() {
    document.querySelectorAll('.nav .nav-item.active').forEach(n => n.classList.remove('active'));
  }

  // Desktop click -> set active persistently
  desktopLinks.forEach(a => {
    a.addEventListener('click', function (e) {
      e.preventDefault();
      clearActiveAll();
      a.classList.add('active');
    });
  });

  // Mobile: clicking an item marks it active AND mirrors to desktop; do not auto-close
  mobileLinks.forEach(a => {
    a.addEventListener('click', function (e) {
      e.preventDefault();
      // mark mobile active
      mobileLinks.forEach(m => m.classList.remove('active'));
      a.classList.add('active');

      // mirror by text match
      const txt = a.textContent.trim();
      const match = desktopLinks.find(n => n.textContent.trim() === txt);
      if (match) {
        clearActiveAll();
        match.classList.add('active');
      }

      // ensure styles apply immediately (icon color etc.)
      // (we don't close offcanvas to keep menu open as requested)
    });
  });

  // KPI click/keyboard handlers + pressed state for tactile feedback
  document.querySelectorAll('.kpi-card').forEach(card => {
    card.addEventListener('click', () => {
      card.classList.add('kpi-pressed');
      setTimeout(() => card.classList.remove('kpi-pressed'), 180);
    });
    card.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        card.click();
      }
    });
  });

});
</script>
{% endblock %}
